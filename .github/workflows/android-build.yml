name: Pull Request # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®åå‰

on: # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç™ºå‹•æ¡ä»¶
  pull_request: # ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    branches: # å¯¾è±¡ãƒ–ãƒ©ãƒ³ãƒ
      - main
    types: # ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—
      - closed # ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚ŒãŸã¨ã

permissions: # æ¨©é™
  contents: write # ãƒªãƒã‚¸ãƒˆãƒªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸ã®æ›¸ãè¾¼ã¿æ¨©é™
  pull-requests: write    # PRã«ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹æ¨©é™
jobs: # ã‚¸ãƒ§ãƒ–
  build: # ã‚¸ãƒ§ãƒ–ã®åå‰
    if: github.event.pull_request.merged == true # ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãƒãƒ¼ã‚¸ã•ã‚ŒãŸã¨ãã®ã¿å®Ÿè¡Œ
    runs-on: ubuntu-latest # å®Ÿè¡Œç’°å¢ƒ

    steps: # ã‚¹ãƒ†ãƒƒãƒ—
      - name: Checkout # ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4 # actions/checkout@v4 ã‚’ä½¿ç”¨

      - name: Set Up JDK # JDK ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-java@v4 # actions/setup-java@v4 ã‚’ä½¿ç”¨
        with: # è¨­å®š
          distribution: 'zulu' # Zulu ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³
          java-version: '18' # Java 18

      - name: Setup Gradle # Gradle ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: gradle/gradle-build-action@v2 # gradle/gradle-build-action@v2 ã‚’ä½¿ç”¨

      - name: Decode google-services.json
        env:
          GOOGLE_SERVICES_JSON: ${{ secrets.GOOGLE_SERVICES_KEY }}
        run: |
          echo "$GOOGLE_SERVICES_JSON" | base64 -d > app/google-services.json

      - name: Build With Gradle # Gradle ã§ãƒ“ãƒ«ãƒ‰
        run: | # å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰,ãƒ‡ãƒãƒƒã‚°ãƒ“ãƒ«ãƒ‰
          ./gradlew assembleDebug 

      - name: Upload APK # APK ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        uses: actions/upload-artifact@v4 # v4 ä»¥é™ã«å¤‰æ›´
        with: # è¨­å®š
          name: app-debug.apk # ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆå
          path: app/build/outputs/apk/debug/app-debug.apk # APK ã®ãƒ‘ã‚¹

      - name: Generate comment # ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
        run: | # å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰,ã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€
          echo "ãƒ‡ãƒãƒƒã‚° APK ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}/artifacts/app-debug.apk" > comment.txt

      - name: Comment on PR
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          RUN_URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
        run: |
          gh pr comment "${{ github.event.pull_request.number }}" --repo "${{ github.repository }}" --body "ğŸš€ ãƒ‡ãƒãƒƒã‚°ãƒ“ãƒ«ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸã€‚
          APKãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯å…ˆï¼ˆArtifactsã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™:
          $RUN_URL"